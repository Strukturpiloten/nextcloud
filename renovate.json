{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:best-practices",
    "docker:disable"
  ],
  "customManagers": [
    {
      "customType": "regex",
      "description": "Update *_IMAGE variables in .env.example",
      "datasourceTemplate": "docker",
      "managerFilePatterns": [
        "/^\\.env\\.example$/"
      ],
      "matchStrings": [
        "\\w+_IMAGE=(?<depName>[^:\\s]+):(?<currentValue>[^@\\s]+)(@(?<currentDigest>sha256:[a-f0-9]+))?"
      ]
    },
    {
      "customType": "regex",
      "description": "Update NEXTCLOUD_VERSION variable in .env.example",
      "datasourceTemplate": "github-releases",
      "managerFilePatterns": [
        "/^\\.env\\.example$/"
      ],
      "matchStrings": [
        "NEXTCLOUD_VERSION=(?<currentValue>[^\\s]+)"
      ],
      "depNameTemplate": "nextcloud/server"
    }
  ],
  "packageRules": [
    {
      "description": "Only allow patch updates for Docker images by default",
      "matchFileNames": [
        ".env.example"
      ],
      "matchUpdateTypes": [
        "minor",
        "major"
      ],
      "enabled": false
    },
    {
      "description": "Allow MARIADB minor/major upgrades only to version 11.4.x with patch >= 2",
      "matchFileNames": [
        ".env.example"
      ],
      "matchDepNames": [
        "docker.io/mariadb"
      ],
      "enabled": true,
      "allowedVersions": "/^11\\.4\\.([2-9]|[1-9][0-9])(-.*)?$/"
    },
    {
      "description": "Allow NGINX minor/major upgrades only to version 1.x.x with patch >= 2",
      "matchFileNames": [
        ".env.example"
      ],
      "matchDepNames": [
        "docker.io/nginxinc/nginx-unprivileged"
      ],
      "enabled": true,
      "allowedVersions": "/^1.\\d+\\.([2-9]|[1-9][0-9])(-.*)?$/"
    },
    {
      "description": "Allow PHPFPM minor/major upgrades only to version 8.4.x with patch >= 1",
      "matchFileNames": [
        ".env.example"
      ],
      "matchDepNames": [
        "docker.io/php"
      ],
      "enabled": true,
      "allowedVersions": "/^8\\.4\\.([1-9]|[1-9][0-9])(-.*)?$/"
    },
    {
      "description": "Allow POSTGRES minor/major upgrades only to version 17.x with minor >= 1",
      "matchFileNames": [
        ".env.example"
      ],
      "matchDepNames": [
        "docker.io/postgres"
      ],
      "enabled": true,
      "allowedVersions": "/^17\\.([1-9]|[1-9][0-9])(-.*)?$/"
    },
    {
      "description": "Allow REDIS minor/major upgrades only to version 8.x.x with patch >= 1",
      "matchFileNames": [
        ".env.example"
      ],
      "matchDepNames": [
        "docker.io/redis"
      ],
      "enabled": true,
      "allowedVersions": "/^8\\.\\d+\\.([1-9]|[1-9][0-9])(-.*)?$/"
    },
    {
      "description": "Allow VALKEY minor/major upgrades only to version 8.x.x with patch >= 1",
      "matchFileNames": [
        ".env.example"
      ],
      "matchDepNames": [
        "docker.io/valkey"
      ],
      "enabled": true,
      "allowedVersions": "/^8\\.\\d+\\.([1-9]|[1-9][0-9])(-.*)?$/"
    },
    {
      "description": "Allow WHITEBOARD minor/major upgrades only to versions with patch >= 2",
      "matchFileNames": [
        ".env.example"
      ],
      "matchDepNames": [
        "ghcr.io/nextcloud-releases/whiteboard"
      ],
      "enabled": true,
      "allowedVersions": "/^v?\\d+\\.\\d+\\.([2-9]|[1-9][0-9])$/"
    },
    {
      "description": "Allow NEXTCLOUD minor/major upgrades only to versions with patch >= 2",
      "matchFileNames": [
        ".env.example"
      ],
      "matchDepNames": [
        "nextcloud/server"
      ],
      "enabled": true,
      "allowedVersions": "/^v?\\d+\\.\\d+\\.([2-9]|[1-9][0-9])$/"
    }
  ]
}